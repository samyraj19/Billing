<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 xmlns:custom="using:KBilling.Controls"
			 xmlns:conv="using:KBilling.Converters"
			 xmlns:vm="using:KBilling.ViewModel"
			 x:DataType="vm:InvoiceVM"
             x:Class="KBilling.InvoiceView">
	<UserControl.DataContext>
		<vm:InvoiceVM/>
	</UserControl.DataContext>
	<UserControl.Resources>
		<conv:RupeesConverter x:Key="Ruppes"/>
	</UserControl.Resources>
	<UserControl.Styles>
		<Style Selector="ListBox">
			<Setter Property="Margin" Value="0,2,0,0"/>
		</Style>
		<Style Selector="ListBoxItem">
			<Setter Property="BorderBrush" Value="#CCC"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="5"/>
		</Style>
		<Style Selector="TextBox">
			<Setter Property="CornerRadius" Value="0"/>
		</Style>
		<Style Selector="CalendarDatePicker">
			<Setter Property="Width" Value="130"/>
			<Setter Property="Margin" Value="0,5"/>
		</Style>

		<Style Selector="CalendarDatePicker /template/ Button#PART_Button">
			<Setter Property="Foreground" Value="Black"/>
			<Setter Property="Background" Value="#E0E0E0"/>
			<Setter Property="Opacity" Value="1"/>
			<Setter Property="HorizontalAlignment" Value="Right"/>
			<Setter Property="Width" Value="30"/>
		</Style>

	</UserControl.Styles>
	<Grid ColumnDefinitions="25* 75*" Margin="2">
		<Border Grid.Column="0"
				BorderBrush="LightGray"
				BorderThickness="0,0,1,0">
			<Grid RowDefinitions="10* 90*">
				<StackPanel Grid.Row="0" Orientation="Vertical">
					<Grid ColumnDefinitions="* *">
						<CalendarDatePicker  Grid.Column="0"
											 SelectedDate="{Binding StartDate}"
											 Watermark="Start Date"/>
						<CalendarDatePicker  Grid.Column="1"
											 SelectedDate="{Binding EndDate}"
											 Watermark="End Date"/>
					</Grid>
					<TextBox Text="{Binding SearchText, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"/>
				</StackPanel>

				<ListBox x:Name="BillsListBox"
						 Grid.Row="1"
						 Background="White"
						 BorderThickness="0"
						 SelectedItem="{Binding SelectedBill,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
						 ItemsSource="{Binding FilterInvoices}">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Grid ColumnDefinitions="50* 30* 20*">
								<Grid Grid.Column="0" RowDefinitions="* *">
									<Label Grid.Row="0"
										   Content="{Binding BillNumber}"
										   FontWeight="SemiBold"/>
									<Label Grid.Row="1"
										   Content="{Binding CustomerName}"
										   FontWeight="SemiLight"/>
								</Grid>
								<Label Grid.Column="1"
									   FontWeight="SemiBold"
									   HorizontalContentAlignment="Center"
									   VerticalContentAlignment="Center"
									   Content="{Binding Total,Converter={StaticResource Ruppes}}"/>
								<Label Grid.Column="2"
									   FontWeight="SemiBold"
									   HorizontalContentAlignment="Center"
									   VerticalContentAlignment="Center"
									   Content="{Binding PaymentMethod}"/>
							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>
				</ListBox>
			</Grid>
		</Border>


		<Grid Grid.Column="1"
			  Background="White">
			<Border CornerRadius="8"
					Background="White"
					Padding="16"
					BorderBrush="#E0E0E0"
					BorderThickness="1" >
				<StackPanel>

					<!-- Header row -->
					<Grid ColumnDefinitions="* 260">
						<StackPanel>
							<TextBlock Text="{Binding SelectedBill.BillNumber}" FontSize="20" FontWeight="Bold"/>
							<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,6,0,0">
								<TextBlock Text="{Binding SelectedBill.CreatedDate}" Foreground="#616161"/>
								<TextBlock Text=" â€¢ " Foreground="#BDBDBD"/>
								<TextBlock Text="Paid" Foreground="#388E3C" FontWeight="SemiBold"/>
							</StackPanel>
						</StackPanel>

						<StackPanel Grid.Column="1" HorizontalAlignment="Right" Orientation="Horizontal" Spacing="8">
							<custom:IconButton Icon="avares://KBilling/Assets/pdf.png" 
											   Content="PDF" 
											   Width="25" Height="25"
											   Command="{Binding ExportPDFCommand}" />
						</StackPanel>

					</Grid>

					<Separator Margin="0,12"/>

					<!-- From / To row -->
					<Grid Margin="0,6">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="1*"/>
							<ColumnDefinition Width="1*"/>
						</Grid.ColumnDefinitions>

						<StackPanel Grid.Column="0">
							<TextBlock Text="From" FontWeight="SemiBold" Foreground="#424242"/>
							<TextBlock Text="My Fancy Store" />
							<TextBlock Text="Phone: 99999 99999" FontSize="12" Foreground="#616161"/>
							<TextBlock Text="Address line goes here" FontSize="12" Foreground="#616161"/>
						</StackPanel>

						<StackPanel Grid.Column="1">
							<TextBlock Text="To" FontWeight="SemiBold" Foreground="#424242"/>
							<TextBlock Text="{Binding SelectedBill.CustomerName}" />
							<TextBlock Text="{Binding SelectedBill.CustomerPhone}" FontSize="12" Foreground="#616161"/>
							<TextBlock Text="nil" FontSize="12" Foreground="#616161"/>
						</StackPanel>
					</Grid>

					<Separator Margin="0,12"/>

					<!-- Items table -->
					<!-- Note: Add Avalonia.Controls.DataGrid NuGet if you want a grid; fallback to ItemsControl for simple lists -->
					<DataGrid ItemsSource="{Binding BillDetails}" AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column" >
						<DataGrid.Columns>
							<DataGridTextColumn Header="Code" Binding="{Binding ProductCode}"  Width="100"/>
							<DataGridTextColumn Header="Name" Binding="{Binding ProductName}" Width="*"/>
							<DataGridTextColumn Header="Qty" Binding="{Binding Quantity}"  Width="75"/>
							<DataGridTextColumn Header="Price" Binding="{Binding Price}"  Width="110"/>
							<DataGridTextColumn Header="Line Total" Binding="{Binding DbAmount}" Width="120"/>
						</DataGrid.Columns>
					</DataGrid>

					<!-- Totals -->
					<Grid Margin="0,5" HorizontalAlignment="Right" Width="360"
						  RowDefinitions="Auto Auto Auto Auto" ColumnDefinitions="* 130">

						<TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal" HorizontalAlignment="Right" />
						<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedBill.SubTotal}" HorizontalAlignment="Right"/>

						<TextBlock Grid.Row="1" Grid.Column="0" Text="Discount" HorizontalAlignment="Right" />
						<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedBill.Discount}" HorizontalAlignment="Right"/>

						<TextBlock Grid.Row="2" Grid.Column="0" Text="Grand Total" FontWeight="Bold" FontSize="16" HorizontalAlignment="Right" Margin="0,8,0,0"/>
						<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedBill.Total}" FontWeight="Bold" FontSize="16" HorizontalAlignment="Right" Margin="0,8,0,0"/>

						<TextBlock Grid.Row="3" Grid.Column="0" Text="Received Amount" FontWeight="Bold" FontSize="16" HorizontalAlignment="Right" Margin="0,8,0,0" />
						<TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedBill.ReceivedAmount}" FontWeight="Bold" FontSize="16" HorizontalAlignment="Right" Margin="0,8,0,0"/>


					</Grid>

					<Separator Margin="0,12"/>

					<TextBlock  Foreground="#616161"/>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>
</UserControl>
